#!/usr/bin/env sh

# search recursively for a pattern in file _names_, and open them in $EDITOR or
# vim

set -eu

if grep --version | head -n 1 | grep -q GNU; then
    grepflags=-izZ
    xargsflags=-0
    findflags=-print0
else
    >&2 echo "warning: grep not safe on newlines: hit Enter to continue"
    read -r
    grepflags=-i
    xargsflags=
    findflags=
fi

# wacky quoting on purpose, so empty variables are ignored
find . -type f $findflags | grep $grepflags "$1" | vim-stdin $xargsflags
